\"use client\";\n\nimport { useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, Trash2, Loader2 } from \"lucide-react\";\nimport type { ArchitectureCategory } from \"@/types/architecture\";\n\ninterface ExtraInput {\n  key: string;\n  value: string;\n}\n\ninterface ArchitectureEditDialogProps {\n  editOpen: boolean;\n  setEditOpen: (open: boolean) => void;\n  formName: string;\n  setFormName: (name: string) => void;\n  formCategory: ArchitectureCategory;\n  setFormCategory: (category: ArchitectureCategory) => void;\n  formDescription: string;\n  setFormDescription: (description: string) => void;\n  formPractices: string;\n  setFormPractices: (practices: string) => void;\n  formScenarios: string;\n  setFormScenarios: (scenarios: string) => void;\n  formReferences: string;\n  setFormReferences: (references: string) => void;\n  formAntiPatterns: string;\n  setFormAntiPatterns: (antiPatterns: string) => void;\n  formExamples: string;\n  setFormExamples: (examples: string) => void;\n  formExtraInputs: ExtraInput[];\n  setFormExtraInputs: (inputs: ExtraInput[]) => void;\n  handleSaveEdit: () => Promise<void>;\n  saveLoading: boolean;\n  ALL_CATEGORIES: ArchitectureCategory[];\n  CATEGORY_LABELS: Record<ArchitectureCategory, string>;\n}\n\nexport function ArchitectureEditDialog({\n  editOpen,\n  setEditOpen,\n  formName,\n  setFormName,\n  formCategory,\n  setFormCategory,\n  formDescription,\n  setFormDescription,\n  formPractices,\n  setFormPractices,\n  formScenarios,\n  setFormScenarios,\n  formReferences,\n  setFormReferences,\n  formAntiPatterns,\n  setFormAntiPatterns,\n  formExamples,\n  setFormExamples,\n  formExtraInputs,\n  setFormExtraInputs,\n  handleSaveEdit,\n  saveLoading,\n  ALL_CATEGORIES,\n  CATEGORY_LABELS,\n}: ArchitectureEditDialogProps) {\n  const addExtraInput = useCallback(() => {\n    setFormExtraInputs((prev) => [...prev, { key: \"\", value: \"\" }]);\n  }, [setFormExtraInputs]);\n\n  const updateExtraInput = useCallback(\n    (index: number, field: \"key\" | \"value\", val: string) => {\n      setFormExtraInputs((prev) => {\n        const next = [...prev];\n        next[index] = { ...next[index], [field]: val };\n        return next;\n      });\n    },\n    [setFormExtraInputs]\n  );\n\n  const removeExtraInput = useCallback(\n    (index: number) => {\n      setFormExtraInputs((prev) => prev.filter((_, i) => i !== index));\n    },\n    [setFormExtraInputs]\n  );\n\n  return (\n    <Dialog open={editOpen} onOpenChange={setEditOpen}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Edit architecture definition</DialogTitle>\n          <DialogDescription>\n            Update fields and add more inputs: references, anti-patterns, examples, or custom key-value inputs.\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"grid gap-4 py-4\">\n          <div className=\"grid gap-2\">\n            <Label htmlFor=\"edit-name\">Name</Label>\n            <Input\n              id=\"edit-name\"\n              value={formName}\n              onChange={(e) => setFormName(e.target.value)}\n              placeholder=\"e.g. Domain-Driven Design\"\n            />\n          </div>\n          <div className=\"grid gap-2\">\n            <Label>Category</Label>\n            <Select value={formCategory} onValueChange={(v) => setFormCategory(v as ArchitectureCategory)}>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {ALL_CATEGORIES.map((cat) => (\n                  <SelectItem key={cat} value={cat}>\n                    {CATEGORY_LABELS[cat]}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"grid gap-2\">\n            <Label htmlFor=\"edit-desc\">Description</Label>\n            <Textarea\n              id=\"edit-desc\"\n              value={formDescription}\n              onChange={(e) => setFormDescription(e.target.value)}\n              placeholder=\"Short overview\"\n              rows={2}\n            />\n          </div>\n          <div className=\"grid gap-2\">\n            <Label htmlFor=\"edit-practices\">Best practices / principles</Label>\n            <Textarea\n              id=\"edit-practices\"\n              value={formPractices}\n              onChange={(e) => setFormPractices(e.target.value)}\n              placeholder=\"Bullet points or markdown\"\n              rows={4}\n              className=\"font-mono text-sm\"\n            />\n          </div>\n          <div className=\"grid gap-2\">\n            <Label htmlFor=\"edit-scenarios\">When to use / scenarios</Label>\n            <Textarea\n              id=\"edit-scenarios\"\n              value={formScenarios}\n              onChange={(e) => setFormScenarios(e.target.value)}\
              placeholder=\"When to apply, scenarios, anti-patterns...\"\n              rows={4}\n              className=\"font-mono text-sm\"\n            />\n          </div>\n          <div className=\"grid gap-2\">\n            <Label htmlFor=\"edit-references\">References</Label>\n            <Textarea\n              id=\"edit-references\"\n              value={formReferences}\n              onChange={(e) => setFormReferences(e.target.value)}\n              placeholder=\"Links, books, docs...\"\n              rows={2}\n            />\n          </div>\n          <div className=\"grid gap-2\">\n            <Label htmlFor=\"edit-anti\">Anti-patterns</Label>\n            <Textarea\n              id=\"edit-anti\"\n              value={formAntiPatterns}\n              onChange={(e) => setFormAntiPatterns(e.target.value)}\n              placeholder=\"What to avoid...\"\n              rows={2}\n            />\n          </div>\n          <div className=\"grid gap-2\">\n            <Label htmlFor=\"edit-examples\">Examples</Label>\n            <Textarea\n              id=\"edit-examples\"\n              value={formExamples}\n              onChange={(e) => setFormExamples(e.target.value)}\n              placeholder=\"Code snippets, diagrams, examples...\"\n              rows={3}\n              className=\"font-mono text-sm\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <Label>Additional inputs</Label>\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={addExtraInput}>\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add input\n              </Button>\n            </div>\n            {formExtraInputs.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">Add custom label-value pairs (e.g. Tools, Checklist).</p>\n            ) : (\n              <ul className=\"space-y-2\">\n                {formExtraInputs.map((row, index) => (\n                  <li key={index} className=\"flex gap-2 items-center\">\n                    <Input\n                      placeholder=\"Label\"\n                      value={row.key}\n                      onChange={(e) => updateExtraInput(index, \"key\", e.target.value)}\n                      className=\"flex-1 min-w-0\"\n                    />\n                    <Input\n                      placeholder=\"Value\"\n                      value={row.value}\n                      onChange={(e) => updateExtraInput(index, \"value\", e.target.value)}\n                      className=\"flex-1 min-w-0\"\n                    />\n                    <Button type=\"button\" variant=\"ghost\" size=\"sm\" className=\"shrink-0 text-destructive\" onClick={() => removeExtraInput(index)}>\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </li>\n                ))}\n              </ul>\n            )}\n          </div>\n        </div>\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => setEditOpen(false)}>\n            Cancel\n          </Button>\n          <Button onClick={handleSaveEdit} disabled={saveLoading || !formName.trim()}>\n            {saveLoading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n            Save\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n